import React, { useState, useEffect, useContext  } from 'react';
import SubjectsContext from '../context/Subjects/SubjectsContext';


function TaskForm(props){
    const userid = props.userid;
    const subjectsContext = useContext(SubjectsContext);

    const [courseSelected, setCourseSelected] = useState(0);
    const [task, setTask] = useState({
        name: '',
        description: '',
        datetime: '',
        priority: '',
        idSECTION: 0,
    });
    

      useEffect(()=>{

    },[task, setTask])

      const handleTask = async (e) =>{
          console.log("noseeeeeeee");
        console.log("namein: ", e.target.name, "idsectionn: ", e.target.value)
        setTask({...task, [e.target.name]:e.target.value} )
    };

    const handleDate = async(e) => {
        
        setDateTime({...dateTime, [e.target.name]:e.target.value});

    };
//EL RANGO DE HORAS QUE PUEDE ELEGIR EL USUARIO VA DE 1 A 12. 
    const HoursConverter12FormatTo24Format = (hour12Format, aMinute, amOrPm) =>{
        let hour24Format = 0;
        if(amOrPm == 'AM'){
            if(hour12Format == 12){
                hour24Format = 0;
            }else{
                hour24Format = hour12Format;
            }
        }

        if(amOrPm=== 'PM'){
            if(hour12Format == 12){

                hour24Format = hour12Format;
            }else{
                hour24Format = parseInt(hour12Format) +12;

            }
        }

        return hour24Format+':'+aMinute;
    }

    

    const createTask = async (e)=>{
        e.preventDefault();

        const taskSnapshot = {...task, datetime: dateTime.year+"/"+dateTime.month+"/"+dateTime.day+" "+HoursConverter12FormatTo24Format(dateTime.hours, dateTime.minutes, dateTime.am_pm)}
        setTask(taskSnapshot);
        console.log("mi post es: ",taskSnapshot);
            const res = await fetch("http://localhost:5000/editTask",{
            method: "PT",
            body: JSON.stringify(taskSnapshot),
            headers: {"Content-Type": "application/json"}
        });
        const resData = await res.json();
        console.log(resData);
        if(!res.ok){ 
            console.log("hubo un error al crear la tarea")
        }else{
            
            console.log("tarea creada: ", task);

        }
    
 
    }




    return (
     
     <>
        <form onSubmit={createTask}>
        <h1>Editar Tarea</h1>
        <label htmlFor="name">Titulo</label>
        <input type="task" name="name" onChange={handleTask}/>
        <label htmlFor="description">Descripcion</label>
        <input type="text" name="description" onChange={handleTask}/>
        </form>
        
        
        </>


    )

}

export default TaskForm;
//Aqui se buscara que la fecha concuerde con el formato de postgres, la hora ahi es de 00:00 hasta 23:59. 

//tienes que cada vez que invoques en el navigate este modulo pasarle la id de la tarea que vas a modificar y usar el controlador que te mostre, donde le pasas esa id y le pasas en el body lo que le vas a modificar, ya?